    .arch armv7-a         @ æŒ‡å®šç›®æ ‡ä½“ç³»ç»“æ„ä¸ºARMv7-A

.data                  @ æ•°æ®æ®?
.section .rodata
_str0:                 
    .ascii "Please input the number\n\0 "   
_str1:
    .ascii "%d\0"     
_str2:
    .ascii "factorial(%d) is %d\n\0"       

.text                  @ ä»£ç æ®?
.global factorial     

factorial:

    str lr, [sp, #-4]!   @ ä¿å­˜é“¾æ¥å¯„å­˜å™¨lråˆ°æ ˆä¸Šï¼Œä½¿ç”¨é¢„å¢é‡æ¨¡å¼ï¼Œsp = sp - 4,push lr
    str r0, [sp, #-4]!    @ å°†nï¼ˆr0ï¼‰ä¿å­˜åˆ°æ ˆä¸Šï¼Œé¢„å¢é‡æ¨¡å¼

    cmp r0, #0           @ æ¯”è¾ƒnï¼ˆr0ï¼‰ä¸0
    bne .L2              @ å¦‚æœn != 0ï¼Œè·³è½¬åˆ°.L2æ ‡ç­¾

    mov r0, #1           @ å¦‚æœn == 0ï¼Œåˆ™è¿”å›1
    b .L3                @ è·³è½¬åˆ?.L3æ ‡ç­¾

.L2:
    sub r0, r0, #1       @ r0 = n-1
    bl factorial         @ é€’å½’è°ƒç”¨factorialå‡½æ•°
    ldr r1, [sp]         @ å°†n-1åŠ è½½åˆ°r1
    mul r0, r0, r1       @ è®¡ç®—n * factorial(n-1)

.L3:
    add sp, sp, #4       @ æ¢å¤æ ˆæŒ‡é’ˆï¼Œsp = sp + 4
    ldr lr, [sp], #4     @ æ¢å¤é“¾æ¥å¯„å­˜å™¨lrï¼Œåå¢é‡æ¨¡å¼
    bx lr                @ è¿”å›ï¼Œæ¢å¤æ ˆæŒ‡é’ˆã€å¸§æŒ‡é’ˆå’Œç¨‹åºè®¡æ•°å™¨

.global main           @ å®šä¹‰mainå‡½æ•°ä¸ºå…¨å±€å¯è§

main:
    str lr, [sp,#-4]!    @ ä¿å­˜é“¾æ¥å¯„å­˜å™¨lråˆ°æ ˆä¸?
    sub sp, sp, #4        @ åˆ†é…4å­—èŠ‚çš„æ ˆç©ºé—´

    ldr r0, _bridge      @ åŠ è½½å­—ç¬¦ä¸? "Please input the number: " çš„åœ°å€åˆ°r0
    bl printf             @ è°ƒç”¨printfæ‰“å°æç¤ºä¿¡æ¯

    mov r1, sp            @ å°†æ ˆæŒ‡é’ˆspçš„åœ°å€å­˜å‚¨åœ¨r1ä¸?
    ldr r0, _bridge+4      @ åŠ è½½å­—ç¬¦ä¸? "%d\0" çš„åœ°å€åˆ°r0ï¼?
    bl __isoc99_scanf     @ è°ƒç”¨scanfè¯»å–ç”¨æˆ·è¾“å…¥çš„æ•´æ•°ï¼Œç»“æœå­˜å‚¨åœ¨r0ä¸?

    ldr r0, [sp]          @ å°†ç”¨æˆ·è¾“å…¥çš„æ•´æ•°nåŠ è½½åˆ°r0

    bl factorial          @ è°ƒç”¨factorialå‡½æ•°è®¡ç®—é˜¶ä¹˜

    mov r2, r0            @ å°†è®¡ç®—ç»“æ?(factorial(n))å­˜å‚¨åœ¨r2ä¸?
    ldr r1, [sp]          @ å°†ç”¨æˆ·è¾“å…¥çš„æ•´æ•°nåŠ è½½åˆ°r1ä¸?
    ldr r0, _bridge+8      @ åŠ è½½å­—ç¬¦ä¸? _str3çš„åœ°å€åˆ°r0
    bl printf             @ è°ƒç”¨printfæ‰“å°é˜¶ä¹˜ç»“æœ

    mov r0, #0             @return 0
    add sp, sp, #4        @ é‡Šæ”¾æ ˆç©ºé—?
    ldr lr, [sp], #4      @ æ¢å¤é“¾æ¥å¯„å­˜å™¨lr
    bx lr                 @ è¿”å›

_bridge:
    .word _str0  @"Please input the number:\n "
    .word _str1  @"%d\0"
    .word _str2  @"factorial(%d) is %d\n\0" 

.section .note.GNU-stack, "", %progbits  
